PAPA: Online Personalized Active Preference Alignment
========

This repository implements [PAPA](https://arxiv.org/abs/####.#####) that efficiently finetunes a pretrained diffusion model for preference alignment without reward modeling. We provide distributed training and sampling codes for MNIST digits and fashion datasets. We build upon the [DDPM](https://arxiv.org/abs/2006.11239) code available [here](https://github.com/explainingai-code/DDPM-Pytorch.git) that mimics the huggingface stable diffusion unet architecture from scratch.

## Overview of PAPA
<img src="https://github.com/NasikNafi/papa/blob/80a3fe994d241ad80c18cd2020174fb29b5bcd43/assets/overview.png" width="300"><img src="https://github.com/NasikNafi/papa/blob/80a3fe994d241ad80c18cd2020174fb29b5bcd43/assets/papa.png" width="300">

## Comparison of Samples Generated by Proposed PAPA and D3PO

<img src="https://github.com/NasikNafi/papa/blob/80a3fe994d241ad80c18cd2020174fb29b5bcd43/assets/comparison.png" width="600">


# Quickstart
* Create a new conda environment with python 3.8 then run below commands
* ```git clone https://github.com/explainingai-code/DDPM-Pytorch.git```
* ```cd DDPM-Pytorch```
* ```pip install -r requirements.txt```
* For training/sampling use the following commands with the desired configuration file. 
* ```python -m tools.train_papa``` for training ddpm
* ```python -m tools.sample_papa``` for generating images

## Configuration
* ```config/default_epapa.yaml``` - allows you to play with different components of DDPM and PAPA.

## Output 
Outputs will be saved according to the configuration present in yaml files.

For each run a folder named after ```sample_path``` key in config will be created under a directory of  ```task_name``` key.

During training of PAPA the following outputs will be saved:
* Latest model checkpoint in ```task_name/sample_path``` directory.
* All generated samples that have been used to finetune the model at each interaction step.
* A folder named ```evaluation``` storing all generated images from every evaluation step. 

During sampling the following output will be saved:
* Sampled image grid in ```task_name/sample_path```.

## Citations
```
@misc{sarkar2026papa,
      title={PAPA: Online Personalized Active Preference Alignment}, 
      author={Anindya Sarkar and Nasik Muhammad Nafi and Yevgeniy Vorobeychik},
      year={2026},
      eprint={####.#####},
      archivePrefix={arXiv},
      primaryClass={####}
}
```
